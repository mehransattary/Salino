@model Salino.Models.User
@using Salino.ViewModels;
@using Salino.DataLayer;
@{
    ViewBag.Title = "Payment";
    Layout = "~/Views/Shared/_Layout.cshtml";
    SalinoContext db = new SalinoContext();
    List<ShopCartItem> ShopCartItem = Session["shopcart"] as List<ShopCartItem>;
    List<ShopCartItem> shopcartMajor = Session["shopcartMajor"] as List<ShopCartItem>;
    List<AllShopCart> AllShopCart = Session["AllShopCart"] as List<AllShopCart>;
    int SumAllPrices = 0;
    int countProduct = 0;
    var senprice = db.SendPrices.Where(x => x.AsNumber != 0).FirstOrDefault();
}

<script src="~/Scripts/city.js"></script>

<link href="~/Content/shopcartstyle.css" rel="stylesheet" />
<style>
    .table > tbody > tr > td, .table > tfoot > tr > td {
        vertical-align: middle;
    }

    .text-center {
        text-align: right !important;
    }

    .nice-select {
        width: 100% !important;
        margin-right: 0px;
    }

    .shopcart p, a, button, h1, h2, h3, li, label {
        font-family: IRANSans
    }
</style>


<div class="container shopcart" style="margin-top: 263px;" id="payment">
    <nav aria-label="breadcrumb" style="direction:rtl;font-family: IRANSans;text-align-last:center ; text-align-last: center;
            box-shadow: 0 0 11px 0 #131212; background: #f89721e6;  box-shadow: 0 0 19px 0 #ed2124 inset;  ">
        <ol class="breadcrumb" style="background: none;    display: block;">
            <li class="breadcrumb-item"><a href="/">صفحه اصلی</a></li>
            @if (Session["shopcartMajor"] == null)
            {
                <li class="breadcrumb-item"><a href="/Product/ShopCart">سبدخرید</a></li>
            }
            else
            {
                <li class="breadcrumb-item"><a href="/Product/Majorshopping">سبدخرید</a></li>
            }


            <li class="breadcrumb-item active" aria-current="page" style="color: #212529;">تایید نهایی سفارشات </li>
        </ol>
    </nav>

    <div class="col-xs-12 col-sm-12 col-md-12 text-left">
        <div class="receipt-right" style="padding: 12px;   margin-top: 36px;  direction: rtl;">






            <!---------پیغام مناسب جشنواره------------------------->
            @if (ViewBag.OfferFirstShop != null)
            {
                <p style="text-align: center; background: green; color: aliceblue;">@ViewBag.OfferFirstShop</p>
            }
            @if (ViewBag.OfferNumberShopsPrice != null)
            {
                <p style="text-align: center; background: green; color: aliceblue;">@ViewBag.OfferNumberShopsPriceText</p>
            }
        </div>
    </div>
    <hr />

    <div class="DetailProduct" id="detailpro">

        <!--=====Desktop============================================================-->
        <div class="shopcartDesktop" style="margin-top: 5px;border: 1px solid;box-shadow: 0 0 16px 0 black;">
            <h5 style="    text-align: center;
    font-family: IRANSans;
    font-size: 20px;
    border: 3px solid #f8f9fa;
    background: black;
    padding: 18px;
    color: white;
    border-radius: 10px;">
                فروشگاه سالینو  _  تایید نهایی سفارشات
            </h5>

            <div class="content" style="direction: rtl; background: white; color: black; box-shadow: 0 0 5px 0 black; padding: 27px;">
                <div class="container" style="margin:0px 0px;">
                    @if (ViewBag.NotCompleteUser != 1 && ViewBag.NotCompleteUser != null)
                    {
                        using (Html.BeginForm("Register", "User"))
                        {
                            @Html.AntiForgeryToken()

                            <div class="form-horizontal">

                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="row">
                                    <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                        @Html.LabelFor(model => model.UserName, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                        <div class="col-md-9">
                                            @Html.EditorFor(model => model.UserName, new { htmlAttributes = new { @class = "form-control", @style = "font-size: 15px;" } })
                                            @Html.ValidationMessageFor(model => model.UserName, "", new { @class = "text-danger " })
                                        </div>
                                    </div>

                                    <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                        @Html.LabelFor(model => model.StreetAddress, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                        <div class="col-md-9">
                                            @Html.EditorFor(model => model.StreetAddress, new { htmlAttributes = new { @class = "form-control", @rows = 3, @Style = " font-size: 16px;" } })
                                            @Html.ValidationMessageFor(model => model.StreetAddress, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                        @Html.Label("استان", htmlAttributes: new { @class = "control-label col-md-3", style = " margin-top:7px;display: flex;" })
                                        <div class="col-md-9">
                                            <p class="float-right">
                                                استان جاری: @db.Ostans.Where(x => x.Id == Model.OstanId).FirstOrDefault().ostanname
                                            </p>
                                            <select style="display: block" name="ostanname" onChange="iranwebsv(this.value);" class="form-control" style="font-family: 'iran';" id="ostan">
                                                <option value="0">لطفا استان را انتخاب نمایید</option>
                                                <option style="font-family: 'iran';" value="1">تهران</option>
                                                <option value="2">گیلان</option>
                                                <option value="3">آذربایجان شرقی</option>
                                                <option value="4">خوزستان</option>
                                                <option value="5">فارس</option>
                                                <option value="6">اصفهان</option>
                                                <option value="7">خراسان رضوی</option>
                                                <option value="8">قزوین</option>
                                                <option value="9">سمنان</option>
                                                <option value="10">قم</option>
                                                <option value="11">مرکزی</option>
                                                <option value="12">زنجان</option>
                                                <option value="13">مازندران</option>
                                                <option value="14">گلستان</option>
                                                <option value="15">اردبیل</option>
                                                <option value="16">آذربایجان غربی</option>
                                                <option value="17">همدان</option>
                                                <option value="18">کردستان</option>
                                                <option value="19">کرمانشاه</option>
                                                <option value="20">لرستان</option>
                                                <option value="21">بوشهر</option>
                                                <option value="22">کرمان</option>
                                                <option value="23">هرمزگان</option>
                                                <option value="24">چهارمحال و بختیاری</option>
                                                <option value="25">یزد</option>
                                                <option value="26">سیستان و بلوچستان</option>
                                                <option value="27">ایلام</option>
                                                <option value="28">کهگلویه و بویراحمد</option>
                                                <option value="29">خراسان شمالی</option>
                                                <option value="30">خراسان جنوبی</option>
                                                <option value="31">البرز</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr />
                                    <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                        @Html.Label("شهر", htmlAttributes: new { @class = "control-label col-md-3", style = " margin-top:7px;display: flex;" })
                                        <div class="col-md-9">
                                            <p class="float-right">
                                                شهرجاری: @Model.cityname
                                            </p>
                                            <select name="cityname" id="city" class="form-control" style="display: block">
                                                <option value="0">لطفا استان را انتخاب نمایید</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                        @Html.LabelFor(model => model.PostalCode, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                        <div class="col-md-9">
                                            @Html.EditorFor(model => model.PostalCode, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.PostalCode, "", new { @class = "text-danger" })
                                        </div>
                                    </div>



                                    <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                        @Html.LabelFor(model => model.Mobile, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                        <div class="col-md-9">
                                            @Html.EditorFor(model => model.Mobile, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                            @Html.ValidationMessageFor(model => model.Mobile, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="margin-top:40px;">
                                    <div class="form-group col-md-12 col-lg-12 col-sm-12 col-xs-12">
                                        <div class="col-md-12">
                                            <input type="submit" value="ثبت" class="btn btn-block   btnregister" style="float: left;" />
                                        </div>


                                    </div>


                                </div>

                            </div>
                        }
                    }
                    else
                    {

                        <div class="row" style="margin:10px 0px;">

                            <div class="col-4 text-center">
                                <label class="fa fa-user" style="font-size: 25px;"> </label> نام : @Model.UserName
                            </div>
                            <div class="col-4 text-center">
                                <label class="fa fa-mobile" style="font-size: 25px;"> </label> شماره همراه : @Model.Mobile
                            </div>
                            <div class="col-4 text-center">
                                <label class="fa fa-address-book" style="font-size: 25px;"> </label>  آدرس:@Model.StreetAddress
                            </div>
                        </div>

                        <div class="row" style="margin:10px 0px;">
                            <div class="col-4 text-center">
                                <label class="fa fa-vcard" style="font-size: 25px;"> </label>   کدپستی : @Model.PostalCode
                            </div>
                            <div class="col-4 text-center">
                                <label class="fa fa-map-marker" style="font-size: 25px;"> </label>   استان : @Model.Ostans.ostanname
                            </div>
                            <div class="col-4 text-center">
                                <label class="fa fa-map-marker" style="font-size: 25px;"> </label>   شهر : @Model.cityname
                            </div>
                        </div>

                    }



                </div>
            </div>
            <!---------حرید کاربر عادی------------------------->
            @if (Session["shopcart"] != null)
            {
                <table id="cart" class="table table-hover table-condensed tblshopcart table-responsive no-padding" style="direction: rtl;padding:25px;">
                    <thead>
                        <tr style="color: black;">
                            <th style="width:25%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">تصویر</th>
                            <th style="width:25%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">کدمحصول</th>
                            <th style="width:20%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">قیمت</th>
                            <th style="width:10%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">تعداد</th>
                            <th style="width:20%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;" class="text-center">جمع</th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in ShopCartItem)
                        {
                            <tr style="height: 154px;">
                                @using (Html.BeginForm("RefreshShopCart", "Product", FormMethod.Post))
                                {
                                    //تصویر ------------------------------
                                    <td>
                                        <img src="~/Content/imgpro/@item.Imgpath" alt="..." class="img-responsive img-thumbnail" style="box-shadow: 0 0 16px 0 black;text-align: center;" id="ImagPath" />

                                    </td>
                                    //توضیحات ------------------------------
                                    <td data-th="Product" style="text-align: center;    padding: 30px;" class="codekala">
                                        <div style="background: white; border: 1px solid; border-radius: 10px; padding: 5px; padding-bottom: 0px; box-shadow: 0 0 14px 0 #212529;margin-right: -6px;">
                                            <p style="background: #ffffff;">
                                                گروه : @db.groupProducts.Find(item.GroupId).GroupTitle

                                            </p>

                                            <p style="background: #ffffff;">
                                                کد :   @db.Products.Find(item.ProductID).CodeKala

                                            </p>


                                            <p style="background: #ffffff;">
                                                جنس : @db.FarbicTypes.Find(item.FarbictypeId).tiltle

                                            </p>
                                        </div>
                                    </td>
                                    //قیمت واحد ------------------------------
                                    <td data-th="Price" style="font-size: initial;text-align: center;">
                                        <input readonly style="text-align:center;text-align: center; box-shadow: 0 0 12px 0 black;" value="@db.FarbicTypes.Find(item.FarbictypeId).PriceMain.ToString("#,0تومان")" />
                                    </td>
                                    //تعداد ------------------------------
                                    <td data-th="Quantity" style="font-size: initial;text-align: center;">
                                        @item.Count عدد

                                    </td>
                                    //جمع کل ------------------------------
                                    <td data-th="Subtotal" class="text-center" style="font-size: initial;text-align: center;">
                                        <input readonly style="text-align:center;text-align: center; box-shadow: 0 0 12px 0 black;" value="@item.sumproduct.ToString(" #,0 تومان")" />

                                    </td>


                                }
                            </tr>
                            SumAllPrices += item.sumproduct;
                            countProduct += item.Count;
                            Session["SumAllPrices"] = SumAllPrices;
                        }
                    </tbody>
                    <tfoot>
                        <tr style="box-shadow: 0 0 10px 0 #212529;">




                            <td></td>
                            @*------ارسال----------------------*@
                            <td>
                                <p style="box-shadow: black 0px 0px 14px 0px; background: #ccff0096; border: 1px solid #212529; text-align: center;"> نوع ارسال </p>



                                <p style="font-size: medium;font-family: IRANSans;text-align:center">
                                    @if (ViewBag.sendtypeId != null)
                                    {
                                        var sendtypeId = Convert.ToInt64(ViewBag.sendtypeId);
                                        @db.TypeSendPosts.Find(sendtypeId).NameHaml
                                    }
                                    else
                                    {
                                        <span>ارسال رایگان</span>
                                    }


                                </p>
                            </td>

                            <!----------تخفیف ---------------------------------->
                            <td>
                                <p style="box-shadow: black 0px 0px 14px 0px; background: #ccff0096; border: 1px solid #212529; text-align: center;"> مبلغ تخفیف </p>


                                <p style="font-size: medium;font-family: IRANSans;text-align:center">

                                    @if (ViewBag.gifcart != null && @ViewBag.OfferFirstShopsPrice != null)
                                    {
                                        string gifcardcode = ViewBag.gifcart.ToString();
                                        <span>@db.giftcards.Where(x => x.Code == gifcardcode).FirstOrDefault().Amount.ToString("#,0 تومان") +@ViewBag.OfferFirstShopsPrice.ToString("#,0 تومان")</span>
                                    }
                                    else if (ViewBag.OfferNumberShopsPrice != null && ViewBag.gifcart != null)
                                    {
                                        string gifcardcode = ViewBag.gifcart.ToString();
                                        <span>@db.giftcards.Where(x => x.Code == gifcardcode).FirstOrDefault().Amount.ToString("#,0 تومان") +@ViewBag.OfferNumberShopsPrice.ToString("#,0 تومان")</span>
                                    }
                                    else if (ViewBag.gifcart != null)
                                    {
                                        string gifcardcode = ViewBag.gifcart.ToString();
                                        @db.giftcards.Where(x => x.Code == gifcardcode).FirstOrDefault().Amount.ToString("#,0 تومان")

                                    }
                                    else if (ViewBag.OfferFirstShopsPrice != null)
                                    {
                                        @ViewBag.OfferFirstShopsPrice.ToString("#,0تومان")
                                    }
                                    else if (ViewBag.OfferNumberShopsPrice != null)
                                    {
                                        @ViewBag.OfferNumberShopsPrice.ToString("#,0تومان")

                                    }
                                    else
                                    {
                                        <span> 0</span>
                                    }
                                </p>


                            </td>

                            <!----------تعدادکل ---------------------------------->
                            <td>
                                <p style="box-shadow: black 0px 0px 14px 0px; background: #ccff0096; border: 1px solid #212529; text-align: center;">تعدادکل</p>
                                <p style="font-size: medium;font-family: IRANSans;text-align:center">

                                    @if (ViewBag.countProduct != null)
                                    {
                                        @ViewBag.countProduct

                                    }
                                    <span>عدد</span>
                                </p>
                            </td>

                            <!----------جمع کل ---------------------------------->
                            <td>
                                <p style="box-shadow: black 0px 0px 14px 0px; background: #ccff0096; border: 1px solid #212529;   text-align: center;">جمع کل</p>
                                <p style="text-align: center; font-size: 15px;">  {{sumAllPrices}} تومان</p>

                            </td>


                            @*------پرداخت----------------------*@
                            <td>

                                @if (ViewBag.NotCompleteUser != 1)
                                {
                                    var userId = Convert.ToInt64(User.Identity.Name);
                                    <a href="/PanelUser/EditPersonalInformation?Id=@userId&typePage=1"
                                       id="btnrefresh" class="btn btn-info btn-block btnrefresh"
                                       style="font-size: medium;font-family: IRANSans;">
                                        لطفا ابتدا اطلاعات خودراوارد کنید
                                        <i class="fa fa-angle-double-left"></i>
                                    </a>
                                }
                                else
                                {
                                    <a target="_blank" href="/Payment/Index/?SumAllPrices=@TempData["sumAllPrices"].ToString()" id="btnrefresh" class="btn btn-info btn-block btnrefresh" style="font-size: medium;font-family: IRANSans;"> پرداخت  <i class="fa fa-angle-double-left"></i></a>

                                }

                            </td>


                        </tr>
                    </tfoot>
                </table>
            }

            else if (Session["shopcartMajor"] != null)
            {
                <table id="cart" class="table table-hover table-condensed tblshopcart table-responsive no-padding" style="direction: rtl;padding:25px">
                    <thead>
                        <tr style="color: black;">
                            <th style="width:25%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">تصویر</th>
                            <th style="width:25%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">کدمحصول</th>
                            <th style="width:20%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">قیمت</th>
                            <th style="width:10%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;">تعداد</th>
                            <th style="width:20%;font-size: initial;text-align:center;box-shadow: 0 0 7px 0 #212529;" class="text-center">جمع</th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in shopcartMajor)
                        {
                            <tr style="height: 154px;">

                                <td>
                                    <img src="~/Content/imgpro/@item.Imgpath" alt="..." class="img-responsive img-thumbnail" style="box-shadow: 0 0 16px 0 black;text-align: center;" id="ImagPath" />

                                </td>
                                <td data-th="Product" style="text-align: center;padding: 30px;" class="codekala">
                                    <div style="background: white; border: 1px solid; border-radius: 10px; padding: 5px; padding-bottom: 0px; box-shadow: 0 0 14px 0 #212529;margin-right: -6px;">
                                        <p style="background: #ffffff;">
                                            گروه : @db.groupProducts.Find(item.GroupId).GroupTitle

                                        </p>

                                        <p style="background: #ffffff;">
                                            کد :   @db.Products.Find(item.ProductID).CodeKala

                                        </p>


                                        <p style="background: #ffffff;">
                                            جنس : @db.FarbicTypes.Find(item.FarbictypeId).tiltle

                                        </p>
                                    </div>
                                </td>
                                <td data-th="Price" style="font-size: initial;text-align: center;">
                                    <input readonly style="text-align:center;text-align: center; box-shadow: 0 0 12px 0 black;" value="@db.FarbicTypes.Find(item.FarbictypeId).PriceMain.ToString("#,0تومان")" />
                                </td>
                                <td data-th="Quantity" style="font-size: initial;text-align: center;">
                                    @item.Count عدد

                                </td>
                                <td data-th="Subtotal" class="text-center" style="font-size: initial;text-align: center;">
                                    <input readonly style="text-align:center;text-align: center; box-shadow: 0 0 12px 0 black;" value="@item.sumproduct.ToString(" #,0 تومان")" />

                                </td>



                            </tr>
                            SumAllPrices += item.sumproduct;
                            countProduct += item.Count;
                            Session["SumAllPrices"] = SumAllPrices;
                        }
                    </tbody>
                    <tfoot>
                        <tr style="box-shadow: 0 0 10px 0 black;">


                            @*------ارسال----------------------*@
                            <td>
                                <p style="box-shadow: black 0px 0px 14px 0px; background: #ccff0096; border: 1px solid #212529; text-align: center;"> نوع ارسال </p>


                                <p style="font-size: medium;font-family: IRANSans;text-align:center">
                                    @if (ViewBag.sendtypeId != null)
                                    {
                                        var sendtypeId = Convert.ToInt64(ViewBag.sendtypeId);
                                        @db.SendForMajors.Find(sendtypeId).NameHaml
                                    }

                                </p>
                            </td>


                            @*------تعداد----------------------*@
                            <td>
                                <p style="box-shadow: black 0px 0px 14px 0px; background: #ccff0096; border: 1px solid #212529; text-align: center;">تعدادکل</p>
                                <p style="font-size: medium;font-family: IRANSans;text-align:center">

                                    @if (ViewBag.countProduct != null)
                                    {
                                        @ViewBag.countProduct

                                    }
                                    <span>عدد</span>
                                </p>
                            </td>
                            @*------جمع کل----------------------*@
                            <td class="">
                                <p style="box-shadow: black 0px 0px 14px 0px; background: #ccff0096; border: 1px solid #212529;   text-align: center;">جمع کل</p>
                                <p style="text-align: center; font-size: 15px;"> جمع کل  :  تومان {{sumAllPrices}}  </p>

                            </td>


                            <td></td>
                            @*------پرداخت----------------------*@
                            <td>
                                @if (ViewBag.NotCompleteUser != 1)
                                {
                                    var userId = Convert.ToInt64(User.Identity.Name);
                                    <a href="/PanelUser/EditPersonalInformation?Id=@userId&typePage=1"
                                       id="btnrefresh" class="btn btn-info btn-block btnrefresh"
                                       style="font-size: medium;font-family: IRANSans;">
                                        لطفا ابتدا اطلاعات خودراوارد کنید
                                        <i class="fa fa-angle-double-left"></i>
                                    </a>

                                }
                                else
                                {
                                    <a target="_blank" href="/Payment/Index/?SumAllPrices=@TempData["sumAllPrices"].ToString()" id="btnrefresh" class="btn btn-info btn-block btnrefresh" style="font-size: medium;font-family: IRANSans;"> پرداخت  <i class="fa fa-angle-double-left"></i></a>

                                }

                            </td>
                        </tr>

                    </tfoot>
                </table>
            }

        </div>

        <!--=====Mobile============================================================-->
        <div class="shopcartMobile" style="margin-top: 5px;border: 1px solid;box-shadow: 0 0 16px 0 black;">
            <h5 style="text-align: center; font-family: IRANSans; font-size: 16px; padding: 18px;
                  color: #212529;">
                فروشگاه سالینو  _  تایید نهایی سفارشات
            </h5>
            <hr />
            <hr />
            <div class="cart">
                <div class="content mobshopcart" style="direction: rtl;  background: aliceblue; color: black;">
                    <div class="container" style="margin:0px 0px;">
                        <p style="text-align:center;background: rgb(82, 82, 82);;    color: white;">مشخصات</p>

                        @if (ViewBag.NotCompleteUser != 1)
                        {

                            using (Html.BeginForm("Register", "User"))
                            {
                                @Html.AntiForgeryToken()

                                <div class="form-horizontal">

                                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                    <div class="row">
                                        <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                            @Html.LabelFor(model => model.UserName, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                            <div class="col-md-9">
                                                @Html.EditorFor(model => model.UserName, new { htmlAttributes = new { @class = "form-control", @style = "font-size: 15px;" } })
                                                @Html.ValidationMessageFor(model => model.UserName, "", new { @class = "text-danger " })
                                            </div>
                                        </div>

                                        <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                            @Html.LabelFor(model => model.StreetAddress, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                            <div class="col-md-9">
                                                @Html.EditorFor(model => model.StreetAddress, new { htmlAttributes = new { @class = "form-control", @rows = 3, @Style = " font-size: 16px;" } })
                                                @Html.ValidationMessageFor(model => model.StreetAddress, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                            @Html.Label("استان", htmlAttributes: new { @class = "control-label col-md-3", style = " margin-top:7px;display: flex;" })
                                            <div class="col-md-9">
                                                <select style="display: block" name="ostanname" onChange="iranwebsv(this.value);" class="form-control" style="font-family: 'iran';" id="ostan">
                                                    <option value="0">لطفا استان را انتخاب نمایید</option>
                                                    <option style="font-family: 'iran';" value="1">تهران</option>
                                                    <option value="2">گیلان</option>
                                                    <option value="3">آذربایجان شرقی</option>
                                                    <option value="4">خوزستان</option>
                                                    <option value="5">فارس</option>
                                                    <option value="6">اصفهان</option>
                                                    <option value="7">خراسان رضوی</option>
                                                    <option value="8">قزوین</option>
                                                    <option value="9">سمنان</option>
                                                    <option value="10">قم</option>
                                                    <option value="11">مرکزی</option>
                                                    <option value="12">زنجان</option>
                                                    <option value="13">مازندران</option>
                                                    <option value="14">گلستان</option>
                                                    <option value="15">اردبیل</option>
                                                    <option value="16">آذربایجان غربی</option>
                                                    <option value="17">همدان</option>
                                                    <option value="18">کردستان</option>
                                                    <option value="19">کرمانشاه</option>
                                                    <option value="20">لرستان</option>
                                                    <option value="21">بوشهر</option>
                                                    <option value="22">کرمان</option>
                                                    <option value="23">هرمزگان</option>
                                                    <option value="24">چهارمحال و بختیاری</option>
                                                    <option value="25">یزد</option>
                                                    <option value="26">سیستان و بلوچستان</option>
                                                    <option value="27">ایلام</option>
                                                    <option value="28">کهگلویه و بویراحمد</option>
                                                    <option value="29">خراسان شمالی</option>
                                                    <option value="30">خراسان جنوبی</option>
                                                    <option value="31">البرز</option>
                                                </select>
                                            </div>
                                        </div>
                                        <hr />
                                        <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                            @Html.Label("شهر", htmlAttributes: new { @class = "control-label col-md-3", style = " margin-top:7px;display: flex;" })
                                            <div class="col-md-9">
                                                <select name="cityname" id="city" class="form-control" style="display: block">
                                                    <option value="0">لطفا استان را انتخاب نمایید</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                            @Html.LabelFor(model => model.PostalCode, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                            <div class="col-md-9">
                                                @Html.EditorFor(model => model.PostalCode, new { htmlAttributes = new { @class = "form-control" } })
                                                @Html.ValidationMessageFor(model => model.PostalCode, "", new { @class = "text-danger" })
                                            </div>
                                        </div>



                                        <div class="form-group col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                            @Html.LabelFor(model => model.Mobile, htmlAttributes: new { @class = "control-label col-md-3", @style = "display: flex;" })
                                            <div class="col-md-9">
                                                @Html.EditorFor(model => model.Mobile, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly" } })
                                                @Html.ValidationMessageFor(model => model.Mobile, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top:40px;">
                                        <div class="form-group col-md-12 col-lg-12 col-sm-12 col-xs-12">
                                            <div class=" col-sm-12">
                                                <input type="submit" value="ثبت" class="btn btn-block   btnregister" style="float: left;" />
                                            </div>


                                        </div>


                                    </div>

                                </div>
                            }

                        }
                        else
                        {
                            <div class="row" style="margin:10px 0px;">

                                <div class="col-12 text-center">
                                    <label class="fa fa-user" style="font-size: 25px;"> </label> نام : @Model.UserName
                                </div>
                            </div>

                            <div class="row" style="margin:10px 0px;">
                                <div class="col-12 text-center">
                                    <label class="fa fa-mobile" style="font-size: 25px;"> </label> شماره همراه : @Model.Mobile
                                </div>
                            </div>

                            <div class="row" style="margin:10px 0px;">
                                <div class="col-12 text-center">
                                    <label class="fa fa-address-book" style="font-size: 25px;"> </label>  آدرس:@Model.StreetAddress
                                </div>
                            </div>

                            <div class="row" style="margin:10px 0px;">
                                <div class="col-12 text-center">
                                    <label class="fa fa-vcard" style="font-size: 25px;"> </label>   کدپستی : @Model.PostalCode
                                </div>
                            </div>

                            <div class="row" style="margin:10px 0px;">
                                <div class="col-12 text-center">
                                    <label class="fa fa-map-marker" style="font-size: 25px;"> </label>    استان : @Model.Ostans.ostanname
                                </div>
                            </div>

                            <div class="row" style="margin:10px 0px;">
                                <div class="col-12 text-center">
                                    <label class="fa fa-map-marker" style="font-size: 25px;"> </label>   شهر : @Model.cityname
                                </div>
                            </div>
                        }




                    </div>
                </div>

                <p style="text-align:center;background:border-box;    color: white;">کالاهای انتخاب شده</p>
                @if (Session["shopcart"] != null)
                {
                    <ul>
                        @foreach (var item in ShopCartItem)
                        {
                            <li class="cart-item" style="background: #f8f9fa;color: black;height: 84px;">
                                <span class="cart-item-pic" style="margin-right: -72px;">
                                    <img src="/Content/imgpro/@item.Imgpath" />
                                </span>
                                <p style="text-align:right;font-size: 11px;">@db.groupProducts.Find(item.GroupId).GroupTitle -  @db.Products.Find(item.ProductID).CodeKala</p>


                                <span class="cart-item-desc" style="margin-top: -32px;">

                                    <p style="color: black; margin-left: 83px; margin-bottom: 13px;direction:rtl">
                                        @item.Count عدد
                                    </p>

                                    <p style="margin-top: -39px;">@db.FarbicTypes.Find(item.FarbictypeId).PriceMain</p>
                                </span>

                                <span class="cart-item-price" style="color: black;right: 194px;direction:rtl">@item.sumproduct.ToString(" #,0 تومان")</span>
                            </li>
                        }
                    </ul>

                }
                else if (Session["shopcartMajor"] != null)
                {
                    <ul>
                        @foreach (var item in shopcartMajor)
                        {
                            <li class="cart-item" style="background: #f8f9fa;color: black;height: 84px;">
                                <span class="cart-item-pic" style="margin-right: -72px;">
                                    <img src="/Content/imgpro/@item.Imgpath" />
                                </span>
                                <p style="text-align:right;font-size: 11px;">@db.groupProducts.Find(item.GroupId).GroupTitle -  @db.Products.Find(item.ProductID).CodeKala</p>
                                <p style="text-align:right;font-size: 11px;"> @db.Products.Find(item.ProductID)..Color.color  -  @db.FarbicTypes.Find(item.FarbictypeId).tiltle</p>




                                <span class="cart-item-desc" style="margin-top: -58px;">

                                    <p style="color: black;    margin-left: -89px;">
                                        @item.Count عدد


                                    </p>
                                    <p style="margin-top: -39px;">@db.FarbicTypes.Find(item.FarbictypeId).PriceMain</p>
                                </span>
                                <span class="cart-item-price" style="color: black;right: 194px;">@item.sumproduct.ToString(" #,0 تومان")</span>
                            </li>
                        }
                    </ul>
                }

                <!--نوع ارسال----------------------------------------->
                @if (Session["shopcart"] != null)
                {
                    <div class="cart-bottom">
                        <p style="font-size: 11px;font-family: IRANSans;text-align:right">
                            نحوه ارسال :
                            @if (ViewBag.sendtypeId != null)
                            {
                                var sendtypeId = Convert.ToInt64(ViewBag.sendtypeId);
                                <span>  @db.TypeSendPosts.Find(sendtypeId).NameHaml   </span>
                            }
                            else
                            {
                                <span>ارسال رایگان</span>
                            }


                        </p>



                    </div>

                }
                else if (Session["shopcartMajor"] != null)
                {
                    <div class="cart-bottom">
                        <p style="font-size: 11px;font-family: IRANSans;text-align:right">
                            نحوه ارسال :
                            @if (ViewBag.sendtypeId != null)
                            {
                                var sendtypeId = Convert.ToInt64(ViewBag.sendtypeId);
                                <span>  @db.SendForMajors.Find(sendtypeId).NameHaml   </span>
                            }



                        </p>



                    </div>
                }
                <!--کدتخفیف----------------------------------------->
                @if (Session["shopcart"] != null)
                {
                    <div class="cart-bottom">
                        <p style="font-size: 11px;font-family: IRANSans;text-align:right">
                            کدتخفیف :
                            @if (ViewBag.gifcart != null && @ViewBag.OfferFirstShopsPrice != null)
                            {
                                string gifcardcode = ViewBag.gifcart.ToString();
                                <span>@db.giftcards.Where(x => x.Code == gifcardcode).FirstOrDefault().Amount.ToString("#,0 تومان") +@ViewBag.OfferFirstShopsPrice.ToString("#,0 تومان")</span>
                            }
                            else if (ViewBag.OfferNumberShopsPrice != null && ViewBag.gifcart != null)
                            {
                                string gifcardcode = ViewBag.gifcart.ToString();
                                <span>@db.giftcards.Where(x => x.Code == gifcardcode).FirstOrDefault().Amount.ToString("#,0 تومان") +@ViewBag.OfferNumberShopsPrice.ToString("#,0 تومان")</span>
                            }
                            else if (ViewBag.gifcart != null)
                            {
                                string gifcardcode = ViewBag.gifcart.ToString();
                                @db.giftcards.Where(x => x.Code == gifcardcode).FirstOrDefault().Amount.ToString("#,0 تومان")

                            }
                            else if (ViewBag.OfferFirstShopsPrice != null)
                            {
                                @ViewBag.OfferFirstShopsPrice.ToString("#,0تومان")
                            }
                            else if (ViewBag.OfferNumberShopsPrice != null)
                            {
                                @ViewBag.OfferNumberShopsPrice.ToString("#,0تومان")

                            }
                            else
                            {
                                <span> 0</span>
                            }
                        </p>



                    </div>

                }

                <!--ثبت نهایی----------------------------------------->
                @if (Session["shopcart"] != null)
                {
                    <div class="cart-bottom">


                        <p style="color:black;    text-align: center;">
                            @if (ViewBag.countProduct != null)
                            {
                            <p style="color:black;direction:rtl; text-align: center;">تعداد :  @ViewBag.countProduct  عدد   </p>
                        }

                            <p style="color:black;direction:rtl; text-align: center;"> جمع کل  :   {{sumAllPrices}}  تومان  </p>

                            </p>

                            @*<a href="#" class="cart-button">Continue</a>*@
                            @if (ViewBag.NotCompleteUser != 1)
                            {
                                var userId = Convert.ToInt64(User.Identity.Name);
                                <a href="/PanelUser/EditPersonalInformation?Id=@userId&typePage=1"
                                   id="btnrefresh" class="btn btn-info btn-block btnrefresh"
                                   style="font-size: medium;font-family: IRANSans;">
                                    لطفا ابتدا اطلاعات خودراوارد کنید
                                    <i class="fa fa-angle-double-left"></i>
                                </a>
                            }
                            else
                            {
                                <a target="_blank" href="/Payment/Index/?SumAllPrices=@TempData["sumAllPrices"].ToString()" id="btnrefresh" class="btn btn-info btn-block btnrefresh" style="font-size: medium;font-family: IRANSans;"> پرداخت  <i class="fa fa-angle-double-left"></i></a>

                            }

                        </div>
                    }
                    else if (Session["shopcartMajor"] != null)
                    {
                        <div class="cart-bottom">


                            <p style="color:black;    text-align: center;">
                                @if (ViewBag.countProduct != null)
                                {
                                <p style="color:black;direction:rtl;text-align: center;">تعداد :  @ViewBag.countProduct  عدد   </p>
                            }

                                <p style="color:black;direction:rtl;text-align: center;"> جمع کل  :  تومان {{sumAllPrices}}    </p>

                                </p>

                                @*<a href="#" class="cart-button">Continue</a>*@
                                @if (ViewBag.NotCompleteUser != 1 && ViewBag.NotCompleteUser != null)
                                {
                                    var userId = Convert.ToInt64(User.Identity.Name);
                                    <a href="/PanelUser/EditPersonalInformation?Id=@userId&typePage=1"
                                       id="btnrefresh" class="btn btn-info btn-block btnrefresh"
                                       style="font-size: medium;font-family: IRANSans;">
                                        لطفا ابتدا اطلاعات خودراوارد کنید
                                        <i class="fa fa-angle-double-left"></i>
                                    </a>
                                }
                                else
                                {
                                    <a target="_blank" href="/Payment/Index/?SumAllPrices=@TempData["sumAllPrices"].ToString()" id="btnrefresh" class="btn btn-info btn-block btnrefresh" style="font-size: medium;font-family: IRANSans;"> پرداخت  <i class="fa fa-angle-double-left"></i></a>
                                }

                            </div>
                        }
            </div>


        </div>


    </div>
</div>

@section scripts
{


    <script src="~/Scripts/vue.js"></script>
    <script src="~/Content/js/jquery/jquery-2.2.4.min.js"></script>


    <script>
        var applist = new Vue({
            el: "#payment",
            data: {

                SumAllPrices: '@TempData["sumAllPrices"].ToString() ',
                sumAllPrices: '@TempData["sumAllPrices"].ToString()'
            },
            methods: {
                SendInformation(id) {
                    vm = this;
                    $.ajax({
                        url: "/Payment/Index",
                        type: "Post",
                        data:
                        {

                            SumAllPrices: vm.SumAllPrices,

                        }
                    });
                }
            },
            watch: {
                SumAllPrices: function (newValue) {

                    const result = newValue.replace(/\D/g, "")
                        .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                    Vue.nextTick(
                        () => this.sumAllPrices = result);
                }
            },
            mounted() {
                this.sumAllPrices = this.sumAllPrices.replace(/\D/g, "")
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            }

        })

    </script>
    <script>
        var coll = document.getElementsByClassName("collapsible");
        var i;

        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            });
        }
    </script>
}
